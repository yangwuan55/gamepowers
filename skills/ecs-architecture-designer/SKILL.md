---
name: ecs-architecture-designer
description: Use when 需要定义或审查游戏技术方案，并强制落实 ECS 架构约束后再进入实现
---

# ECS 架构设计师（严格流程）

## 适用条件
- 涉及技术实现结构、系统拆分、性能预算。
- 需要判定方案是否满足 ECS 契约。

## 输入契约
必填输入：
- 玩法机制主文档。
- 当前任务映射与技术任务清单。
- 目标平台性能预算。

可选输入：
- 既有引擎限制、部署约束、网络模型。

## ECS 设计流程
1. 实体建模：定义实体生命周期与标识策略。
2. 组件建模：只定义数据，不混入业务行为。
3. 系统拆分：单责原则，定义输入输出边界。
4. 调度编排：给出稳定执行顺序与依赖。
5. 事件流设计：事件生产/消费/落库边界。
6. 性能预算：帧预算、热点路径、采样指标。

## 强制校验清单（缺一不可）
- 实体不承载业务逻辑。
- 组件是纯数据结构。
- 系统职责无重叠冲突。
- 调度顺序稳定且可复现。
- 事件流无隐式副作用。
- 性能预算有明确阈值与观测点。
- 技术任务包含 `architecture: ECS` 和 `ecs_refs`。

## 输出模板
- 目标
- 实体目录
- 组件目录
- 系统职责矩阵
- 调度图
- 事件流图
- 性能预算
- 风险与回滚

## 禁止项（反模式）
- 在组件中写业务逻辑。
- 多系统同时写同一核心状态且无仲裁。
- 用脚本顺序偶然满足逻辑，不定义正式调度。
- 未定义预算直接进入实现。

## 验证与回滚
- 验证失败时，禁止 handoff。
- 技术冲突无法消解时，记录 ADR 并触发架构回滚。

## 否决权
对技术一致性冲突拥有最终否决权；不满足 ECS 契约的方案不得进入 superpowers 实现。

## 与协调层联动
- 向 `game-design-orchestrator` 回传 ECS 审查结果。
- 与 `design-handoff-to-superpowers` 对齐交接契约。

## 完成判定
- ECS 文档齐备。
- 强制校验全部通过。
- 技术任务映射可直接执行。
