---
name: mechanic-spec-writer
description: Use when 需要把玩法与技能机制写成可执行规则规格，并明确判定优先级与边界
---

# 机制规格编写（严格流程）

## 适用条件
- 已有愿景与核心循环，需要下钻到规则级实现。
- 需要将玩法机制、技能机制转换为可验收规则。

## 输入契约
必填输入：
- 循环规格：`docs/gamepowers/gameplay/core-loop-spec.md`
- 愿景约束：`docs/gamepowers/gameplay/gameplay-vision.md`
- 目标机制范围（战斗、技能、物品、交互）。

可选输入：
- 历史数值问题、玩家反馈、bug 复盘。

输入缺失处理：一次只问一个问题，不并发追问。

## 设计步骤
1. 规则拆解：将每个机制拆成输入、判定、输出、副作用。
完成定义：每条规则结构完整且字段一致。
2. 优先级定义：定义规则冲突时的优先级与仲裁顺序。
完成定义：存在明确“谁覆盖谁”的判定表。
3. 边界条件补全：补充异常、极端输入、并发触发场景。
完成定义：异常路径具备可测试预期。
4. 技能系统对齐：把技能机制并入统一规则体系。
完成定义：技能规则与通用机制无语义冲突。
5. 验收场景生成：为关键规则生成最小验收用例。
完成定义：每类机制至少 1 个正向 + 1 个异常用例。

## 输出工件
- 主文档：`docs/gamepowers/gameplay/mechanics-spec.md`
- 主文档：`docs/gamepowers/skills/skill-system-spec.md`
- 任务映射证据：`docs/gamepowers/index/task-doc-map.yaml`

## 质量门禁
- 规则条目结构统一（输入/判定/输出/边界/优先级）。
- 规则冲突有明确仲裁顺序，禁止“按实现细节决定”。
- 机制任务可追溯到文档并可同步 `bd`。

## 风险与缓解
- 风险：规则描述过于抽象，工程不可落地。
缓解：每条核心规则必须带最小验收场景。
- 风险：技能规则与战斗规则重复定义。
缓解：以单一词汇表统一字段，冲突交由协调层仲裁。

## 与 ECS/协调层联动
- 将技术实现相关规则映射到 `architecture: ECS` 任务并补充 `ecs_refs`。
- 与 `ecs-architecture-designer` 对齐状态归属、事件流和系统边界。
- 将规则变更通过 `game-design-orchestrator` 同步至任务映射与 `bd`。

## 反模式（禁止）
- 只写“预期体验”，不写判定逻辑。
- 在不同文档定义同一规则的不同含义。
- 跳过异常场景直接交接实现。

## 完成判定
- 机制规则可直接作为开发与测试输入。
- 技术实现规则已绑定 ECS 引用。
- 与任务映射、bd 状态一致。
