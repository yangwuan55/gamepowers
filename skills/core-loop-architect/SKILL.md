---
name: core-loop-architect
description: Use when 需要定义局内与局外核心循环，并沉淀为可执行的循环规格文档
---

# 核心循环架构师（严格流程）

## 适用条件
- 需要定义或重构主循环、次循环、失败恢复与回流路径。
- 玩法方向已明确，但循环结构尚未固化。

## 输入契约
必填输入：
- 愿景文档：`docs/gamepowers/gameplay/gameplay-vision.md`
- 目标玩家行为目标（单局时长、失败成本、回流动机）。
- 关键系统约束（匹配、奖励、成长节奏）。

可选输入：
- 现有埋点数据、留存漏斗分析、历史迭代记录。

输入缺失处理：一次只问一个问题，不并发追问。

## 设计步骤
1. 主循环定义：拆解单局起点、关键决策点、终局判定。
完成定义：形成可复现的循环路径与状态转移条件。
2. 局外循环定义：定义资源回收、成长反馈、再次开局动机。
完成定义：形成局外回流闭环并标注触发条件。
3. 失败恢复设计：明确失败后恢复路径与防挫败机制。
完成定义：每种失败都有恢复动作和可观测事件。
4. 循环耦合检查：校验主循环与局外循环是否互相强化。
完成定义：无“断链环节”，每段可被后续机制承接。
5. 任务映射收敛：把循环节点映射到机制文档与任务条目。
完成定义：核心节点均有文档引用和任务键。

## 输出工件
- 主文档：`docs/gamepowers/gameplay/core-loop-spec.md`
- 审查输入：`docs/gamepowers/gameplay/mechanics-spec.md`（仅审查建议，不覆盖主结论）
- 任务映射证据：`docs/gamepowers/index/task-doc-map.yaml`

## 质量门禁
- 主循环、局外循环、失败恢复三块均可执行。
- 状态转移条件明确，无隐式规则。
- 关键循环节点均绑定验收标准并可映射到 `bd`。

## 风险与缓解
- 风险：循环链路过长导致流失上升。
缓解：限制关键环节数量并给出中断补偿路径。
- 风险：局内与局外奖励方向冲突。
缓解：用统一收益目标做冲突裁剪并记录取舍。

## 与 ECS/协调层联动
- 由 `game-design-orchestrator` 统一排期和门禁。
- 涉及系统调度或状态一致性的任务标记 `architecture: ECS` 并提交 `ecs-architecture-designer` 审查。
- 同步更新 `task-doc-map.yaml` 后再写入 `bd`。

## 反模式（禁止）
- 只给流程图，不给状态条件和失败路径。
- 越权修改 `mechanic-spec-writer` 的规则主定义。
- 未映射任务直接进入 handoff。

## 完成判定
- 循环规格可直接驱动机制细化。
- 循环节点与任务映射完整。
- 与 ECS 约束和协调层排期保持一致。
